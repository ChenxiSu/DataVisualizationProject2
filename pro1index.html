<html>
<head>
<title>Info5100 Project1</title>
<script type="text/javascript" src="list-highest-mountains.json"> </script> 
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<meta charset="utf-8">
<style>
  .land {
    fill: #ccc;
    stroke: #000;
    stroke-opacity:0.2;
  }
   
 
  svg {
    padding: 30px;
  }
  #l1{
    position: absolute;
    top: 750;
    left: 50;
    width: 200px;
    height: 70px;
    font-family: "Palatino";
  }
  #l2{
    position: absolute;
    font-size: 16px;    
    top: 15;
    left: 35;
  }
  #l3{
    position: absolute;
    top: 740;
    left: 900;
  }
  .legend h1{
    margin: 0;
    margin-top: 8;
    padding: 0;
    text-align: center;
  }

  .legend p{
    margin: 0;
    margin-top: 0;
    margin-left: -10;
    font-size: 13px;
    padding: 0;
    text-align: left;
  }
  #grad {
    background: -webkit-linear-gradient(left, green, yellow, red); /* For Safari 5.1 to 6.0 */
    background: -o-linear-gradient(left, green, yellow, red); /* For Opera 11.1 to 12.0 */
    background: -moz-linear-gradient(left, green, yellow, red); /* For Firefox 3.6 to 15 */
    background: linear-gradient(to left, green, yellow, red); /* Standard syntax */
    opacity: .7;
    width: 150px;
    height: 15px;
    position: absolute;
    top: -20;
    left: 10;
  }
  .axis path { fill: none; stroke: black; }
  .axis line { stroke: black; }
  .axis text { font-size: 8pt; }
  .title {
    alignment-baseline: middle; 
    text-anchor: middle;
    font-size: 40;
    font-family: "Arial";  
  }
  .subtitle {
    alignment-baseline: middle; 
    text-anchor: middle;
    font-size: 20;
    font-family: "Arial"; 
  }
</style>
</head>

<body>
<div id="map">
  <div class="legend" id="l1"><p id="l2">Color: Success Rate</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100%</p><div id="grad"></div></div>
</div>


<div id="l3">
: Number of people succeeded</br></br>
: Number of people failed</br></br>
*Each icon represents 20 people
</div>

<script>

var width = 1100,
    height = 1300,
    mapHeight = 1000,
    mtnWidth = 200,
    mtnHeight = 100;

var padding = 0;

var projection = d3.geo.conicConformal()
  .scale(1000) // map size
  .rotate([-105, 0]) //map rotate
  .center([-18, 45]); // map center's location

var path = d3.geo.path().projection(projection);

var svg = d3.select("#map").append("svg")
                           .attr("width", width)
                           .attr("height", height);

svg.append("text")
  .attr("x", width/2)
  .attr("y", 40)
  .attr("class", "title")
  .style("font-family", "Palatino")
  .style("font-weight","bold")
  .text("Highest Mountains in the World");
svg.append("text")
  .attr("x", width/2)
  .attr("y", 75)
  .attr("class", "subtitle")
  .style("font-family", "Palatino")
  .text("Where are they located and what");
svg.append("text")
  .attr("x", width/2)
  .attr("y", 100)
  .attr("class", "subtitle")
  .style("font-family", "Palatino")
  .text("percentage of people succeed in climbing them?");
   
svg.append("text")
  .attr("x", width/2)
  .attr("y", mapHeight+mtnHeight+120)
  .attr("class", "title")
  .style("font-family", "Palatino")
  .text("Five Most Attempted Mountains")
svg.append("path")
  .attr("d", path)
  .style("stroke-opacity",0.2)
  .style("stroke-width",0.2)

var difficultyScale = d3.scale.linear().domain([0,0.5,1]).range(["green","orange", "red"]);
var countryScale = d3.scale.linear().domain([0,800]).range(["#CEE3F6", "#0174DF"]);

d3.json("world-50m.json", function(error, world) {
  if (error) throw error;
 
  var c1 = world.objects.countries.geometries.filter(function(d) { return d.id == 156; })[0];
  var c2 = world.objects.countries.geometries.filter(function(d) { return d.id == 704; })[0];
  var c3 = world.objects.countries.geometries.filter(function(d) { return d.id == 418; })[0];
  var c4 = world.objects.countries.geometries.filter(function(d) { return d.id == 764; })[0];
  var c5 = world.objects.countries.geometries.filter(function(d) { return d.id == 104; })[0];
  var c6 = world.objects.countries.geometries.filter(function(d) { return d.id == 356; })[0];
  var c7 = world.objects.countries.geometries.filter(function(d) { return d.id == 64; })[0];
  var c8 = world.objects.countries.geometries.filter(function(d) { return d.id == 524; })[0];
  var c9 = world.objects.countries.geometries.filter(function(d) { return d.id == 50; })[0];
  var c10 = world.objects.countries.geometries.filter(function(d) { return d.id == 586; })[0];
  var c11 = world.objects.countries.geometries.filter(function(d) { return d.id == 762; })[0];
  var c12 = world.objects.countries.geometries.filter(function(d) { return d.id == 860; })[0];
  var c13= world.objects.countries.geometries.filter(function(d) { return d.id == 417; })[0];
  var c14= world.objects.countries.geometries.filter(function(d) { return d.id == 4; })[0];
  var listofcountry=[];
  listofcountry.push(c1);
  listofcountry.push(c2);
  listofcountry.push(c3);
  listofcountry.push(c4);
  listofcountry.push(c5);
  listofcountry.push(c6);
  listofcountry.push(c7);
  listofcountry.push(c8);
  listofcountry.push(c9);
  listofcountry.push(c10);
  listofcountry.push(c11);
  listofcountry.push(c12);
  listofcountry.push(c13);
  listofcountry.push(c14);

  for(i=0;i<listofcountry.length;i++){
  svg.insert("path")
     .datum(topojson.feature(world, listofcountry[i]))
     .attr("class", "land")
     .attr("d", path)
     .style("fill", function(d){
      return countryScale(listofcountry[i].id);
   })
     .attr("opacity", 0.4);         
  }
  
  var countryname=[{Long:100,la:35, Name:"China"},
                   {Long:107,la:13, Name:"Vietnam"},
                   {Long:101,la:20, Name: "Laos"},
                   {Long:100,la:15, Name:"Thailand"},
                   {Long:94,la:21,  Name:"Myanmar"},
                   {Long:79,la:23,  Name:"India"},
                   {Long:89.5,la:27,  Name:"Bhutan"},
                   {Long:80.1,la:28.9,  Name:"Nepal"},
                   {Long:68,la:28.5,  Name:"Pakistan"},
                   {Long:64,la:33,  Name:"Afghanistan"},
                   {Long:69,la:38,  Name:"Tajikistan"},
                   {Long:73,la:41,  Name:"Kyrgyzstan"},
                   {Long:60,la:41,  Name:"Uzbekistan"},
                   {Long:87.5,la:24,  Name:"Bangladesh"}]
  
 for(m=0;m<countryname.length;m++){    
     var countrypro=projection([countryname[m].Long,countryname[m].la])
     svg.append("text").text(countryname[m].Name)
     .attr("x", countrypro[0])
     .attr("y",countrypro[1])
     .style("fill","grey")
     .style("font-family", "Palatino")
     .style("font-size","17px");
 }                                                               
    
  d3.json("list-highest-mountains.json", function(error, mountaindata) {
    if (error) throw error;
      
    //draw triangles
    var lineData = [{ "x": 5,   "y": 0},  { "x": 10,  "y": 8.66},
                    { "x": 0,  "y": 8.66}, { "x": 5,   "y": 0}];
   
    var lineFunction = d3.svg.line()
      .x(function(d) { return d.x; })
      .y(function(d) { return d.y; })
      .interpolate("linear");
  
    svg.selectAll("svg")
     .data(mountaindata)
     .enter()
     .append("path")
     .attr("transform", function(d){ 
        //var scalenumb=2;
        var scalenumb=Math.pow(d.HeightINm/6500,6);  
        var mtprojection=projection([d.Longitude,d.Latitude]);
        return "translate(" + (mtprojection[0]-5*scalenumb) + " , " + (mtprojection[1]-5.78*scalenumb) + " )  scale(" + scalenumb + ")"        
      })
     .attr("d", lineFunction(lineData))
     .attr("stroke-width", function(d){
         if (d.Rank==1||d.Rank==9||d.Rank==6||d.Rank==5||d.Rank==8) {    
         return 0.4; }  
         else return 0;
    })
     .attr("stroke",function(d){
        if (d.Rank==1||d.Rank==9||d.Rank==6||d.Rank==5||d.Rank==8)
        return "grey";
        else return "white";
    })
     .style("fill",function(d) {
        var diffdata=d.SuccessRate;
        return difficultyScale(diffdata);             
      })
      .attr("opacity",function(d){
        var scalenumb=Math.pow(d.HeightINm/8848,6);  
        return scalenumb;
    })      
  
    // legend for heights   
    var xScale = d3.scale.linear().domain([7000, 8500]).range([0, 150]);
    var xAxis = d3.svg.axis().scale(xScale)
      .tickFormat(shorten)
      .ticks("4")
      .orient("bottom");
    svg.append("g").attr("transform", "translate(23,790)")
                   .attr("class", "axis")
                   .call(xAxis);
   
    svg.append("path").attr("transform", function(d){
                               var scalenum=Math.pow(8500/6500,6)
                               return "translate(149,747) scale(" + scalenum + ")"
                       })
                      .attr("d", lineFunction(lineData))               
                      .style("fill", "grey")
                      .style("opacity",0.5)
   
    
    svg.append("path").attr("transform", function(d){
                               var scalenum=Math.pow(8000/6500,6)
                               return "translate(106,760) scale(" + scalenum + ")"
                       })
                       .attr("d", lineFunction(lineData))
                       .style("fill", "grey")
                       .style("opacity",0.5);
   
    
    svg.append("path").attr("transform", function(d){
                               var scalenum=Math.pow(7800/6500,6)
                               return "translate(58,764.5) scale(" + scalenum + ")"
                       })
                      .attr("d", lineFunction(lineData))
                      .style("fill", "grey")
                      .style("opacity",0.5);
     
      
     svg.append("path").attr("transform", function(d){
                               var scalenum=Math.pow(7300/6500,6)
                               return "translate(14,773) scale(" + scalenum + ")"
                       })
                      .attr("d", lineFunction(lineData))               
                      .style("fill", "grey")
                      .style("opacity",0.5);
      svg.append("text").text("Height (meters)").attr("x", 50).attr("y", 826);
 
  });    
});
    
 
    
var shorten = function(n) { 
  if (Number(n) < 1000)
    return n;
  else if (Number(n) < 1000000)
    return Number(n) / 1000 + "K";
  else if (Number(n) < 1000000000)
    return Number(n) / 1000000 + "M";
  else
   return Number(n) / 1000000000 + "B"; 
}

var xScale = d3.scale.linear()
  .domain([0,10000])
  .range([padding, mtnWidth-padding]);
var yScale = d3.scale.linear()
  .domain([6000,9000])
  .range([mapHeight+mtnHeight-padding, mapHeight+padding]);
var yScaleDisplay = d3.scale.linear()
  .domain([7000,9000])
  .range([yScale(7000), yScale(9000)]);
var yAxis = d3.svg.axis().scale(yScaleDisplay)
  .orient("left")
  .tickFormat(shorten)
  .ticks(3)
  .outerTickSize(0);
svg.append("g").attr("class", "axis")
  .attr("transform", "translate(" + 75 + ",0)")
  .call(yAxis);
svg.append("line")
  .attr("x1", 69)
  .attr("x2", 75)
  .attr("y1", yScale(6000))
  .attr("y2", yScale(6000))
  .style("stroke", "black")
  .style("stroke-width", 1);
svg.append("line")
  .attr("x1", 75)
  .attr("x2", 75)
  .attr("y1", yScale(6000))
  .attr("y2", yScale(6400))
  .style("stroke", "black")
  .style("stroke-width", 1);
svg.append("line")
  .attr("x1", 75+4)
  .attr("x2", 75-4)
  .attr("y1", yScale(6400)-2)
  .attr("y2", yScale(6400)+2)
  .style("stroke", "black")
  .style("stroke-width", 1);
svg.append("line")
  .attr("x1", 75+4)
  .attr("x2", 75-4)
  .attr("y1", yScale(6600)-2)
  .attr("y2", yScale(6600)+2)
  .style("stroke", "black")
  .style("stroke-width", 1);
svg.append("line")
  .attr("x1", 75)
  .attr("x2", 75)
  .attr("y1", yScale(6600))
  .attr("y2", yScale(7000))
  .style("stroke", "black")
  .style("stroke-width", 1);
svg.append("text")
  .attr("y", yScale(6000)+3)
  .attr("x", 54)
  .text("0K")
  .style("font-size", "8pt");
svg.append("text")
  .attr("y", 20)
  .attr("x",(-(mapHeight + mtnHeight/2 +42)))
  .attr("dy", ".75em")
  .attr("transform", "rotate(-90)")
  .text("Height (meters)")
  .style("font-size", 14);

// Everest    
svg.append('image')
  .attr('xlink:href','everest.jpg')
  .attr("x", 480+padding/2)
  .attr("y", yScale(8848))
  .attr('height', yScale(6000)-yScale(8848))
  .attr('width', mtnWidth-padding); 
svg.append("text")
  .text("Everest (8,848m)")
  .attr("x", 420+mtnWidth/2)
  .attr("y", yScale(6000) + 60)
  .style("font-size", 16);
// Nanga Parbat
svg.append('image')
  .attr('xlink:href','nanga.jpg')
  .attr("x", 80+padding/2)
  .attr("y", yScale(8126))
  .attr('height', yScale(6000)-yScale(8126))
  .attr('width', mtnWidth-padding);
svg.append("text")
  .text("Nanga Parbat (8,126m)")
  .attr("x", 25+mtnWidth/2)
  .attr("y", yScale(6000) + 60)
  .style("font-size", 16);
// Cho Oyu
svg.append('image')
  .attr('xlink:href','cho.jpg')
  .attr("x", 285+padding/2)
  .attr("y", yScale(8188))
  .attr('height', yScale(6000)-yScale(8188))
  .attr('width', mtnWidth-padding);
svg.append("text")
  .text("Cho Oyu (8,188m)")
  .attr("x", 235+mtnWidth/2)
  .attr("y", yScale(6000) + 60)
  .style("font-size", 16);
//Makalu
svg.append('image')
  .attr('xlink:href','makalu.jpg')
  .attr("x", 880+padding/2)
  .attr("y", yScale(8485))
  .attr('height', yScale(6000)-yScale(8485))
  .attr('width', mtnWidth-padding);
svg.append("text")
  .text("Makalu (8,485m)")
  .attr("x", 835+mtnWidth/2)
  .attr("y", yScale(6000) + 60)
  .style("font-size", 16);
// Manaslu
svg.append('image')
  .attr('xlink:href','manaslu.jpg')
  .attr("x", 675+padding/2)
  .attr("y", yScale(8163))
  .attr('height', yScale(6000)-yScale(8163))
  .attr('width', mtnWidth-padding);
svg.append("text")
  .text("Manaslu (8,163m)")
  .attr("x", 645+mtnWidth/2)
  .attr("y", yScale(6000) + 60)
  .style("font-size", 16);

//draw arrows
var arrow=[{"x":0.5,"y":0},{"x":0.5,"y":50},{"x":0,"y":48},{"x":0.5,"y":50},{"x": 1,"y":48}]
var lineFunction=d3.svg.line()
  .x(function(d) { return d.x; })
  .y(function(d) { return d.y; })
  .interpolate("linear");

svg.append("g")
   .attr("id", "arrow1");
var arrow1 = d3.select("#arrow1")
arrow1.append("path")
      .attr("d", lineFunction(arrow))
      .attr("stroke", "grey")
      .attr("stroke-width", 0.2)
      .attr("fill", "none")
      .attr("opacity", 0.6);

svg.append("g")
   .attr("id", "arrow2")
var arrow2 = d3.select("#arrow2")
arrow2.append("path")
      .attr("d", lineFunction(arrow))
      .attr("stroke", "grey")
      .attr("stroke-width", 0.3)
      .attr("fill", "none")
      .attr("opacity", 0.6);

svg.append("g")
   .attr("id", "arrow3")
var arrow3 = d3.select("#arrow3")
arrow3.append("path")
      .attr("d", lineFunction(arrow))
      .attr("stroke", "grey")
      .attr("stroke-width", 0.25)
      .attr("fill", "none")
      .attr("opacity", 0.6);

svg.append("g")
   .attr("id", "arrow4")
var arrow4 = d3.select("#arrow4")
arrow4.append("path")
      .attr("d", lineFunction(arrow))
      .attr("stroke", "grey")
      .attr("stroke-width", 0.25)
      .attr("fill", "none")
      .attr("opacity", 0.6);

svg.append("g")
   .attr("id", "arrow5")
var arrow5 = d3.select("#arrow5")
arrow5.append("path")
      .attr("d", lineFunction(arrow))
      .attr("stroke", "grey")
      .attr("stroke-width", 0.22)
      .attr("fill", "none")
      .attr("opacity", 0.6);
    

arrow1.attr("transform", "translate(300,370) scale(11) rotate(10)"); 
arrow2.attr("transform", "translate(395,500) scale(8.4) rotate(0)"); 
arrow3.attr("transform", "translate(407,512) scale(8.4) rotate(-15) "); 
arrow4.attr("transform", "translate(425,500) scale(9.6) rotate(-32)"); 
arrow5.attr("transform", "translate(435,500) scale(11.8) rotate(-47)"); 


// Draw people

  var peoeleSizeParameter = 2.; 
  var pxScale = d3.scale.linear().domain([0,6.5]).range([0, 6.5*peoeleSizeParameter]);
  var pyScale = d3.scale.linear().domain([0,14]).range([0, 14*peoeleSizeParameter]);

  var pBodyData = [ {"x":pxScale(0),"y":pyScale(3.5)}, {"x":pxScale(0),"y":pyScale(8.5)}, 
                    {"x":pxScale(1),"y":pyScale(8.5)}, {"x":pxScale(1),"y":pyScale(4.5)}, 
                    {"x":pxScale(1.5),"y":pyScale(4.5)}, {"x":pxScale(1.5),"y":pyScale(14)}, 
                    {"x":pxScale(3),"y":pyScale(14)}, {"x":pxScale(3),"y":pyScale(9)}, 
                    {"x":pxScale(3.5),"y":pyScale(9)}, {"x":pxScale(3.5),"y":pyScale(14)}, 
                    {"x":pxScale(5),"y":pyScale(14)}, {"x":pxScale(5),"y":pyScale(4.5)}, 
                    {"x":pxScale(5.5),"y":pyScale(4.5)}, {"x":pxScale(5.5),"y":pyScale(8.5)}, 
                    {"x":pxScale(6.5),"y":pyScale(8.5)}, {"x":pxScale(6.5),"y":pyScale(3.5)}, 
                    {"x":pxScale(0),"y":pyScale(3.5)}];

  function drawGreenPeople(pid, x, y) {

    var lineFunction = d3.svg.line()
      .x(function(d) { return d.x; })
      .y(function(d) { return d.y; })
      .interpolate("linear");

    svg.append("g")
      .attr("id", pid); 

    var pid = d3.select("#"+ pid +"");
    var circleFunction = pid.append("circle")
            .attr("cx", pxScale( 6.5/2))
            .attr("cy", pyScale( 3.5/2))
            .attr("r", pyScale( 3.5/2));

    pid.append("path")
      .attr("d", lineFunction(pBodyData));

    pid.attr("fill", "green")
      .attr("opacity", 0.7) 
      .attr("transform", "translate("  + x + ", " +  y + ")"); 
  }


  function drawRedPeople(pid, x, y) {

    var lineFunction = d3.svg.line()
      .x(function(d) { return d.x; })
      .y(function(d) { return d.y; })
      .interpolate("linear");

    svg.append("g")
      .attr("id", pid); 

    var pid = d3.select("#"+ pid +"");
    var circleFunction = pid.append("circle")
            .attr("cx", pxScale( 6.5/2))
            .attr("cy", pyScale( 3.5/2))
            .attr("r", pyScale( 3.5/2));

    pid.append("path")
      .attr("d", lineFunction(pBodyData));

    pid.attr("fill", "red")
      .attr("opacity", 0.7)  
      .attr("transform", "translate("  + x + ", " +  y + ")"); 
  }

// NangaParbat(52, 67)
  drawGreenPeople("NangaParbatG1", 170, 1005);
  drawGreenPeople("NangaParbatG2", 190, 995);
  drawGreenPeople("NangaParbatG3", 210, 1005);

  drawRedPeople("NangaParbatR1", 170, 1105);
  drawRedPeople("NangaParbatR2", 190, 1105);
  drawRedPeople("NangaParbatR3", 210, 1105);

// ChoOyu(79, 28)
  drawGreenPeople("ChoOyuG1", 330, 1015);
  drawGreenPeople("ChoOyuG2", 350, 1000);
  drawGreenPeople("ChoOyuG3", 370, 1005);
  drawGreenPeople("ChoOyuG4", 390, 1010);

  drawRedPeople("ChoOyuR1", 350, 1105);

// Everest(145, 121)
  drawGreenPeople("EverstG1", 505, 1030);
  drawGreenPeople("EverstG2", 525, 1010);
  drawGreenPeople("EverstG3", 545, 990);
  drawGreenPeople("EverstG4", 565, 965);
  drawGreenPeople("EverstG5", 585, 980);
  drawGreenPeople("EverstG6", 605, 1005);
  drawGreenPeople("EverstG7", 625, 1030);

  drawRedPeople("EverstR1", 515, 1105);
  drawRedPeople("EverstR2", 535, 1105);
  drawRedPeople("EverstR3", 555, 1105);
  drawRedPeople("EverstR4", 575, 1105);
  drawRedPeople("EverstR5", 595, 1105);
  drawRedPeople("EverstR6", 615, 1105);

// Manaslu(49, 45)
  drawGreenPeople("ManasluG1", 810, 995);
  drawGreenPeople("ManasluG2", 790, 1015);

  drawRedPeople("ManasluR1", 810, 1105);
  drawRedPeople("ManasluR2", 790, 1105);

// Makalu(45, 52)
  drawGreenPeople("MakaluG1", 970, 990);
  drawGreenPeople("MakaluG2", 990, 985);

  drawRedPeople("MakaluR1", 960, 1105);
  drawRedPeople("MakaluR2", 980, 1105);
  drawRedPeople("MakaluR3", 1000, 1105);

// Legend
  drawGreenPeople("legendG1", 845, 697);
  drawRedPeople("LegendR1", 845, 737);

// add a legend for the second visualization

</script>    
</body>
    
</html>
